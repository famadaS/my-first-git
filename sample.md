# 程式說明書

## F020_Dec.jsp

### 程式說明書 - F020_無實體發行登錄申請查詢交易

#### 基本資料
- **程式名稱**：F020_Dec.jsp
- **程式功能**：提供無實體發行登錄與申請查詢的功能，包括登錄、交付及查詢等操作。
- **首次簽入Stream**：SHAS_DEV1\1
- **程式日期**：未提供
- **程式作者**：未提供
- **表單編號**：未提供

#### 修改紀錄
- **2010-02-02**：R100116 - 顯示千分位
- **2010-04-15**：R110307 - 控管配發/交付日逾系統日不得操作
- **2011-04-28**：R110404 - 依颱風天作業調整登錄及配發/交付日期檢核
- **2011-12-23**：R110926 - 減資登錄/交付作業
- **2014-04-21**：R140406 - 彈性面額
- **2015-01-24**：R150116 - add 13G
- **2017-12-29**：R171025 - 申請發行作業平台原系統功能修改
- **2021-03-25**：UTF-8 ALL - 更新至UTF-8編碼

#### 功能說明
- **登錄類別解析**：根據使用者輸入的登錄類型，顯示相對應的登錄類別描述。
- **證券類別解析**：顯示證券的類別，例如：一般有價證券、私募證券等。
- **操作選項**：提供登錄、交付及查詢等操作選項，並根據操作類型及狀態動態調整可用選項。
- **日期檢核**：對於配發/交付日期進行檢核，確保日期的合理性。
- **千分位顯示**：在顯示數字時自動添加千分位符號，提高閱讀性。
- **彈性面額**：支持彈性面額的設定與顯示。
- **UTF-8編碼**：支持UTF-8編碼，增強系統的兼容性與國際化。

#### 技術細節
- **JSP標籤庫**：使用JSP標籤庫（Taglib）來簡化JSP頁面開發。
- **JavaScript函數**：利用JavaScript進行前端數據校驗與動態元素操作。
- **AJAX技術**：通過AJAX與後端進行非同步數據交互，提升用戶體驗。
- **日期選擇器**：集成日期選擇器控件，方便用戶選擇日期。
- **後端服務接口**：與後端服務接口進行交互，實現數據的查詢、提交等功能。

#### 使用說明
1. **證券代號輸入**：用戶需先輸入證券代號，系統將根據證券代號提供相應的批號選項。
2. **選擇操作**：根據需求選擇登錄、交付或查詢等操作。
3. **填寫相關信息**：根據選擇的操作類型，填寫相關的操作信息，如配發/交付日期等。
4. **提交與查詢**：完成必要信息填寫後，點擊提交進行操作或查詢以獲取信息。

#### 注意事項
- 確保輸入的數據正確無誤。
- 注意操作的選項及狀態，不同的操作狀態下可用的功能可能有所不同。
- 系統日期與配發/交付日期的檢核，確保日期的合理性及規範性。


## F020_Dec.java

### 程式說明書 - F020_Dec Servlet (無實體發行登錄申請查詢交易)

#### 基本資料
- **程式目的**：實現無實體發行登錄及申請查詢的功能。
- **程式名稱**：F020_Dec.java
- **作者**：Shen Zhipeng
- **版權**：wistronits.com
- **程式日期**：20051224
- **表單編號**：N/A
- **首次簽入之Stream**：SHAS_INT

#### 修改紀錄
- **2011-04-28**：R110404 - 依颱風天作業調整登錄及配發/交付日期檢核
- **2011-10-21**：R110210 - 配合Warrant調整控管
- **2012-02-06**：R120134 - 暫時提供該證券無須檢核股數功能並已回復
- **2012-05-10**：R120513 - 暫時提供該證券無須檢核股數功能並已回復
- **2012-06-18**：R120618 - 暫時提供該證券無須檢核股數功能並已回復
- **2012-08-15**：R120705 - 規劃限制型股票登錄暨帳簿劃撥交付作業，移除控管配發與交付股數
- **2012-08-01**：R120746 - 暫時提供該證券無須檢核股數功能並已回復
- **2015-01-24**：R150116 - add 13G

#### 功能說明
此Servlet主要處理無實體發行登錄及申請查詢的請求，包含以下功能：
- **資料檢核**：對用戶輸入的資料進行校驗。
- **資料新增**：實現無實體發行登錄資料的新增。
- **資料查詢**：提供無實體發行登錄資料的查詢功能。
- **資料更新**：支持對無實體發行登錄資料的更新。

#### 技術細節
- **資料校驗**：在`checkInput`方法中，對前端傳來的資料進行校驗，確保資料的正確性與完整性。
- **數據處理**：`insertAction`、`updateAction`、`selectAction`等方法分別實現資料的新增、更新和查詢功能。
- **數據庫連接**：透過`setConnection`方法設置數據庫連接，以便於操作數據庫。
- **操作結果**：所有操作完成後，通過`AppStatus`類返回操作結果和相關信息。

#### 注意事項
- 在進行數據新增或更新操作前，必須嚴格檢查用戶輸入的資料，防止不合法的資料被提交到數據庫。
- 需要確保數據庫的連接正確設置，並在操作完成後妥善關閉連接，避免資源泄漏。
- 操作過程中可能會涉及到多表聯查或更新，需要注意保持數據的一致性和完整性。
- 對於複雜的業務邏輯，應當進行細致的設計和測試，以確保系統的穩定性和可靠性。


## F020_PrintData.jsp

### 程式說明書 - F020_無實體發行登錄列印報表

#### 基本資料
- **程式名稱**：F020_PrintDataAll.jsp
- **程式功能**：列印無實體發行登錄的相關報表。
- **程式日期**：2011-04-28
- **程式作者**：950889
- **表單編號**：R110404 (依颱風天作業調整登錄及配發/交付日期檢核)
- **首次簽入之Stream**：SHAS_DEV1\1

#### 修改紀錄
- **2014-04-14**：R140406 - 彈性面額
- **2021-08-16**：UTF-8 ALL - 更新至UTF-8編碼

#### 功能說明
這個JSP頁面負責生成和列印無實體發行登錄交易的報表。報表包含了多個重要字段，例如交易序號、作業日期、證券代號、參加人代號、選項等，以提供完整的交易紀錄概覽。

#### 技術細節
- **資料取得**：透過`comGET.getDAllF022Bean(decdt,indate,trantype)`從後端獲取相關報表資料，`decdt`（決策日期）、`indate`（登錄日期）和`trantype`（交易類型）為關鍵參數。
- **報表生成**：根據取得的資料動

態生成報表內容。若無相關資料，則重定向至`noData.jsp`頁面。
- **報表格式**：報表以表格形式展現，每行顯示一條交易記錄，包括認證欄、交易序號、作業日期、證券代號、參加人代號、選項、類別、舊標的證券代號、數額、主管卡、備註等資訊。
- **類別與選項解析**：報表中的`類別`和`選項`根據交易的具體情況展示相對應的描述，增強報表的可讀性。

#### 注意事項
- 確保所有的查詢參數準確無誤，以便獲取正確的報表資料。
- 報表的列印和展示需要適當地處理中文字符和特殊字符，確保報表的正確顯示。
- 頁面中包含的CSS和JavaScript應正確引用，以確保報表的正確格式和功能性。

#### 實作細節
- 頁面首先透過JSP標籤庫引入必要的CSS樣式和JavaScript函數，確保報表的美觀和互動性。
- 使用`<%@ include file="/include/checkUserValid.jsp"%>`

來檢查用戶的登錄狀態，確保只有合法的用戶可以訪問報表。
- 透過`request.getParameter`方法獲取從前端傳來的參數（如`indate`、`decdt`、`trantype`），這些參數將用於查詢特定條件下的報表資料。
- 若查詢無結果，使用`response.sendRedirect`重定向用戶至`noData.jsp`，提醒用戶沒有可顯示的資料。
- 對於查詢到的每條記錄，動態生成HTML表格行(`<tr>`)來展示報表資料，並利用`<c:out>`標籤進行HTML轉義，防止XSS攻擊。
- 最後，利用CSS樣式對報表進行美化，保證報表的可讀性和專業性。

這份報表提供了一個完整且詳細的無實體發行登錄交易記錄，對於財務分析和交易審核具有重要價值。

## F020_PrintDataAll.jsp

### 程式說明書 - F020_無實體發行登錄列印報表

#### 基本資料
- **程式名稱**：F020_PrintDataAll.jsp
- **程式功能**：產生並顯示無實體發行登錄交易的列印報表。
- **程式日期**：2011-04-28
- **程式作者**：950889
- **表單編號**：R110404
- **首次簽入之Stream**：SHAS_DEV1\1

#### 修改紀錄
- **2014-04-14**：R140406_彈性面額
- **2021-08-16**：UTF-8 ALL - 系統全面更新至UTF-8編碼，以支持更廣泛的語言和字符。

#### 功能說明
本頁面主要用於生成無實體發行登錄交易的列印報表，該報表包括交易序號、作業日期、證券代號、參加人代號、選項、類別、舊標的證券代號、數額、主管卡、備註等信息，旨在提供交易的詳細記錄以供審核或記錄之用。

#### 技術細節
- **資料準備**：透過後端方法`comGET.getDAllF020Bean(decdt,indate,trantype)`根據指定的條件（作業日期、決策日期、交易類型）查詢報表所需的數據。
- **頁面跳轉**：如果查詢結果為空，則重定向至`noData.jsp`頁面，提示用戶沒有相關數據。
- **動態內容生成**：利用JSP技術動

態生成報表內容，包括設置頁面屬性、遍歷數據陣列並輸出每一條記錄的詳細信息。
- **頁面設計**：報表以HTML表格形式展示，並透過CSS樣式進行美化，以提高報表的可讀性和專業外觀。
- **資料格式化**：對於數值類型的資料，如數額，進行格式化處理（例如，添加千分位），以便於閱讀。

#### 注意事項
- 確保所有查詢參數的準確性，以防止錯誤的報表數據生成。
- 對於特殊字符和中文的處理，需適當使用HTML轉義，以避免XSS攻擊或字符顯示錯誤。
- 重定向至`noData.jsp`時，應注意用戶體驗，適當提供返回或重新查詢的選項。

#### 實施建議
- 考慮到報表可能涉及大量數據的處理，建議進一步優化後端查詢邏輯和前端顯示方式，以提高系統性能和用戶體驗。
- 可以加入更多的互動元素，如查詢條件的動態調整、報表的導出功能等，以增強報表的實用性和便利性。
- 保持系統和程式碼的更新，定期檢查並修復可能存在的安全漏洞或錯誤，以維護系統的穩定運行和數據的準確性。

## D_F020_LOG.java

### 程式說明書 - D_F020_LOG Data Bean

#### 基本資料
- **程式包名**：com.wistronits.shas.dataBean
- **類別名稱**：D_F020_LOG
- **繼承**：D_LOG
- **版本**：1.0
- **序列化ID**：-4257212952695632633L
- **作者**：未提供
- **功能說明**：提供用於存儲無實體發行登錄相關日誌資訊的數據結構。

#### 屬性說明
- **conftype**：交易確認類型。
- **stkno**：證券代號。
- **batno**：批號。
- **issueid**：發行人ID。
- **trantype**：交易類型。
- **apptype**：申請類型。
- **apptype850**：申請類型850。
- **appshr**：申請數量。
- **openshr**：公開申購及競拍數額。
- **indate**：登錄日期。
- **logonid**：登錄用戶ID。
- **manid**：管理者ID。

#### 方法說明
- **Setters**：為每個屬性提供設定方法，用於修改屬性值。
- **Getters**：為每個屬性提供獲取方法，用於獲取屬性值。

#### 功能描述
此類別主要用於記錄和傳遞無實體發行登錄相關的日誌資訊。它包含了交易確認類型、證券代號、批號、發行人ID、交易類型、申請類型、申請數量、登錄日期等關鍵信息，以及相關操作者的ID，以便於系統進行日誌記錄和追蹤。

#### 使用場景
- 在進行無實體發行登錄相關操作時，如新增、修改或查詢登錄信息，系統將利用此類別來記錄相關日誌資訊。
- 這些日誌資訊將用於審計、數據追蹤和問題診斷等。

#### 注意事項
- 確保在操作過程中正確設置和獲取屬性值，以保證日誌資訊的準確性和完整性。
- 在系統架構中，應妥善處理此類別的實例化和資源回收，避免內存洩漏。

## L_F020_Bean.java

### 程式說明書 - L_F020_Bean (Logical Bean for F020 Transactions)

#### 基本資料
- **程式包名**：com.wistronits.shas.logicalBean
- **類別名稱**：L_F020_Bean
- **程式日期**：20051224
- **程式作者**：Shen Zhipeng
- **功能說明**：處理無實體發行登錄相關業務邏輯，包含新增、修改和查詢功能。
- **首次簽入之Stream**：SHAS_DEV1\1

#### 修改紀錄
- **2011-05-20**：R110404 - 依颱風天作業調整登錄及配發/交付日期檢核
- **2011-10-21**：R110210 - 配合Warrant調整控管
- **2011-12-30**：R110926 - 減資登錄/交付作業-F020證券類別
- **2014-04-21**：R140406 - 彈性面額
- **2014-10-07**：R141001 - 發行類別為1：無實體集保戶
- **2018-12-03**：R181025 - 無實體登錄作業簡化暨登錄證明e化作業

#### 功能描述
L_F022_Bean提供了無實體發行登錄相關操作的業務邏輯處理，包括但不限於以下功能：
- **新增操作**：處理無實體發行登錄的新增請求。
- **查詢操作**：根據特定條件查詢無實體發行登錄資料。
- **修改操作**：更新無實體發行登錄的相關信息。

#### 技術細節
- **XML處理**：使用`XMLProcessNonAPP`類來處理與無實體發行登錄相關的XML檔案。
- **資料庫操作**：通過`PreparedStatement`和`ResultSet`進行資料的查詢、新增和更新。
- **日誌記錄**：透過`OperLogger.writeF022OperateLog`方法記錄操作日誌。
- **業務邏輯處理**：根據業務需求處理各種業務邏輯，如檢查條件、組裝SQL語句等。

#### 使用場景
- 當用戶透過系統界面發起無實體發行登錄的相關操作時，相應的請求將被轉發至此類別進行處理。
- 系統需要根據業務規則檢查用戶的請求是否合法，並對資料進行相應的處理。
- 在處理完畢後，系統將根據操作結果向用戶響應成功或失敗的訊息。

#### 注意事項
- 確保所有的業務邏輯都嚴格按照規定執行，避免產生不必要的錯誤。
- 對於每次資料庫操作，需要妥善處理`SQLException`，並在操作完成後關閉資源。
- 在處理XML相關操作時，需確保XML檔案的格式正確無誤。

此類別為無實體發行登錄提供了完整的後端支持，是系統與資料庫交互的核心部分。